@use "@kth/style/scss/tokens/icons";
@use "@kth/style/scss/utils/mixins";
@use "@kth/style/scss/components/visually-hidden";
@use "vars" as *;

$icon-kpm-feed: url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2220%22%20height%3D%2220%22%20fill%3D%22none%22%3E%3Cg%20clip-path%3D%22url(%23a)%22%3E%3Cmask%20id%3D%22b%22%20width%3D%2220%22%20height%3D%2220%22%20x%3D%220%22%20y%3D%220%22%20maskUnits%3D%22userSpaceOnUse%22%20style%3D%22mask-type%3Aalpha%22%3E%3Cpath%20fill%3D%22%23D9D9D9%22%20d%3D%22M0%200h20v20H0z%22%2F%3E%3C%2Fmask%3E%3Cg%20mask%3D%22url(%23b)%22%3E%3Cpath%20fill%3D%22%23212121%22%20d%3D%22M7.525%2015.26c-.453%200-.836-.158-1.147-.471a1.563%201.563%200%200%201-.468-1.144V12.53h9.645V5.895h1.114c.45%200%20.83.157%201.145.47.313.314.47.696.47%201.145v10.794l-3.045-3.045H7.525Zm-5.809-1.155V3.31c0-.45.157-.83.47-1.144.314-.314.695-.47%201.145-.47h9.11c.448%200%20.83.156%201.143.47.314.313.47.695.47%201.144v6.104c0%20.45-.156.83-.47%201.145-.313.313-.695.47-1.144.47H4.796l-3.08%203.075ZM12.326%209.3V3.425h-8.88v5.876h8.88Z%22%2F%3E%3C%2Fg%3E%3C%2Fg%3E%3Cdefs%3E%3CclipPath%20id%3D%22a%22%3E%3Cpath%20fill%3D%22%23fff%22%20d%3D%22M0%200h20v20H0z%22%2F%3E%3C%2FclipPath%3E%3C%2Fdefs%3E%3C%2Fsvg%3E");
$icon-kpm-interrobang: url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2220%22%20height%3D%2220%22%20fill%3D%22none%22%3E%3Cpath%20fill%3D%22%23212121%22%20fill-rule%3D%22evenodd%22%20d%3D%22M10%2019a9%209%200%201%200%200-18%209%209%200%200%200%200%2018Zm0-2.023a6.977%206.977%200%201%200%200-13.954%206.977%206.977%200%200%200%200%2013.954Z%22%20clip-rule%3D%22evenodd%22%2F%3E%3Cpath%20fill%3D%22%23212121%22%20d%3D%22M9.446%2011.49v-.068c0-.31.028-.604.085-.882a2.37%202.37%200%200%201%20.316-.78c.15-.242.365-.455.643-.64.327-.215.564-.448.712-.698.15-.253.226-.56.226-.92a1.194%201.194%200%200%200-.682-1.13%201.49%201.49%200%200%200-1.261-.009c-.2.092-.364.234-.495.427-.13.19-.206.436-.226.737H7.47c.02-.511.149-.943.388-1.295.241-.356.558-.624.95-.806a3.062%203.062%200%200%201%201.304-.273c.522%200%20.98.101%201.372.303.392.199.696.476.912.83.219.353.328.758.328%201.215%200%20.512-.128.958-.384%201.338a3.214%203.214%200%200%201-.958.93%203.623%203.623%200%200%200-.652.498%201.06%201.06%200%200%200-.269.482c-.04.173-.06.397-.06.673v.068h-.954Zm0%200-.205-3.763h1.108l-.11%203.763h-.793Zm.465%202.591a.827.827%200%200%201-.601-.247.825.825%200%200%201-.252-.605c0-.233.084-.432.252-.597a.82.82%200%200%201%20.6-.251c.23%200%20.43.083.597.251a.8.8%200%200%201%20.256.597c0%20.156-.04.3-.12.43a.881.881%200%200%201-.306.307.812.812%200%200%201-.426.115Z%22%2F%3E%3C%2Fsvg%3E");
$icon-kpm-mail: url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2220%22%20height%3D%2220%22%20fill%3D%22none%22%3E%3Cg%20clip-path%3D%22url(%23a)%22%3E%3Cmask%20id%3D%22b%22%20width%3D%2220%22%20height%3D%2220%22%20x%3D%220%22%20y%3D%220%22%20maskUnits%3D%22userSpaceOnUse%22%20style%3D%22mask-type%3Aalpha%22%3E%3Cpath%20fill%3D%22%23D9D9D9%22%20d%3D%22M0%200h20v20H0z%22%2F%3E%3C%2Fmask%3E%3Cg%20mask%3D%22url(%23b)%22%3E%3Cpath%20fill%3D%22%23212121%22%20d%3D%22M3.56%2016.17c-.48%200-.887-.17-1.224-.506a1.668%201.668%200%200%201-.505-1.225V5.554c0-.48.168-.886.505-1.221A1.672%201.672%200%200%201%203.56%203.83h12.88c.48%200%20.887.168%201.224.505.337.337.505.745.505%201.225v8.885c0%20.48-.168.886-.505%201.221a1.672%201.672%200%200%201-1.224.502H3.56ZM10%2011.213%203.56%207.485v6.955h12.88V7.485L10%2011.215Zm0-1.925%206.44-3.73H3.56L10%209.29ZM3.56%207.485V5.56v8.88-6.955Z%22%2F%3E%3C%2Fg%3E%3C%2Fg%3E%3Cdefs%3E%3CclipPath%20id%3D%22a%22%3E%3Cpath%20fill%3D%22%23fff%22%20d%3D%22M0%200h20v20H0z%22%2F%3E%3C%2FclipPath%3E%3C%2Fdefs%3E%3C%2Fsvg%3E");
$icon-kpm-notifications: url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2220%22%20height%3D%2220%22%20fill%3D%22none%22%3E%3Cg%20clip-path%3D%22url(%23a)%22%3E%3Cmask%20id%3D%22b%22%20width%3D%2220%22%20height%3D%2220%22%20x%3D%220%22%20y%3D%220%22%20maskUnits%3D%22userSpaceOnUse%22%20style%3D%22mask-type%3Aalpha%22%3E%3Cpath%20fill%3D%22%23D9D9D9%22%20d%3D%22M0%200h20v20H0z%22%2F%3E%3C%2Fmask%3E%3Cg%20mask%3D%22url(%23b)%22%3E%3Cpath%20fill%3D%22%23212121%22%20d%3D%22M3.83%2015.67v-1.73h.94V9.11c0-1.252.382-2.357%201.143-3.315.761-.958%201.752-1.553%202.972-1.785V2.945c0-.31.109-.573.326-.79.216-.216.48-.324.789-.324.31%200%20.573.108.79.325.216.216.325.48.325.79v1.063c1.223.233%202.215.827%202.975%201.784.76.956%201.14%202.062%201.14%203.317v4.83h.94v1.73H3.83ZM10%2018.223c-.43%200-.796-.152-1.1-.457a1.5%201.5%200%200%201-.455-1.098h3.115c0%20.434-.153.801-.458%201.103a1.51%201.51%200%200%201-1.101.452ZM6.5%2013.94h7V9.11c0-.973-.34-1.799-1.02-2.48-.681-.68-1.508-1.02-2.48-1.02s-1.799.34-2.48%201.02c-.68.681-1.02%201.507-1.02%202.48v4.83Z%22%2F%3E%3C%2Fg%3E%3C%2Fg%3E%3Cdefs%3E%3CclipPath%20id%3D%22a%22%3E%3Cpath%20fill%3D%22%23fff%22%20d%3D%22M0%200h20v20H0z%22%2F%3E%3C%2FclipPath%3E%3C%2Fdefs%3E%3C%2Fsvg%3E");

#kpm-6cf53 .kpm-icon-button {
  display: flex;
  width: 2.25rem;
  height: 2.5rem;
  align-items: center;
  justify-content: center;

  &::before {
    width: 1.5rem;
    height: 1.5rem;
    background: var(--color-primary);
  }

  &.interrobang::before {
    @include icons.with-icon($icon-kpm-interrobang);
  }
  &.mail::before {
    @include icons.with-icon($icon-kpm-mail);
  }
  &.feed::before {
    @include icons.with-icon($icon-kpm-feed);
  }
  &.notifications::before {
    @include icons.with-icon($icon-kpm-notifications);
  }
}

#kpm-6cf53 .kpm-menu {
  pointer-events: all;
  background-color: var(--kpmMenuBg);
  color: var(--kpmMenuText);
  width: 100%;
  flex-grow: 0;
  border-bottom: solid 1px var(--kpmPaneBg);

  > ul {
    @include mixins.container;
    display: flex;
    justify-content: flex-end;
    gap: 0 1rem;
  }

  li {
    display: block;
    list-style: none;
    cursor: pointer;

    &.kpm-try span {
      background: var(--kpmMenuText);
      border-radius: 50%;
      color: var(--kpmMenuBg);
      display: inline-block;
      line-height: 1.2;
      padding: 0 0.4em;
      font-size: 60%;
    }
  }

  a.kth-menu-item.active {
    text-underline-offset: 0.5rem;
    text-decoration: underline;
    text-decoration-thickness: 0.25rem;
  }

  // Use for profile image and icons
  // Default pad is mainly a type hint for validators
  $fullMenuHeight: calc(1.5em + 2 * var(--kpmPad, 1em));

  .kpm-mobile-menu > a,
  .kpm-profile-item > a {
    $rowGap: calc(2 * var(--kpmGap));
    $colGap: $rowGap;

    display: flex;
    align-items: center;
    gap: $rowGap $colGap;
    padding: 0 calc(3.5 * var(--kpmPad)) 0 0;

    .kpm-profile-image {
      height: $fullMenuHeight;
      width: $fullMenuHeight;
    }
  }

  .kpm-menu-shotcuts {
    display: flex;
    flex-direction: row;

    .kpm-loading {
      opacity: 0.8;
      filter: blur(1px);
    }

    .kpm-has-new-notices {
      position: relative;

      .kpm-notice-new {
        background: var(--kpmAlertBg);
        border-radius: 100%;
        color: var(--kpmMenuHoverText);
        min-width: 1.5rem;
        height: 1.5rem;
        display: block;
        font-size: 0.9rem;
        line-height: 100%;
        padding: 0.3rem;
        position: absolute;
        right: 0.1em;
        text-align: center;
        top: 0.1em;
      }
      .kpm-notice-new-trail {
        display: none;
      }
    }
  }
}

#kpm-6cf53 {
  .kpm-mobile-menu.kpm-mobile,
  .kpm-profile-item.kpm-mobile,
  .kpm-mobile-logout.kpm-mobile {
    display: none;
  }
}

// Menu
@media #{$mblBreakpoint} {
  body #kpm-6cf53 > .kpm-menu {
    height: 2.6rem;
    overflow: hidden;
    transition: height 0.2s ease-out;

    &.active {
      height: 100vh;

      .kpm-mobile-menu {
        & > a,
        & > a:hover,
        & > a:active {
          background-color: var(--kpmMenuHoverBg);
          color: var(--kpmMenuHoverText);
          outline: none;

          &::after {
            background: $data-arrow-expand-black-svg no-repeat;
          }
        }
      }
    }
  }

  body #kpm-6cf53 > .kpm-menu > ul {
    flex-direction: column;

    & > .kpm-mobile-menu {
      display: inline-flex;
    }

    & > .kpm-menu-shotcuts {
      position: fixed;
      top: 0;
      right: 0;
      font-size: 1.8em;
    }

    .kpm-profile-item {
      // Hide profile image
      img {
        display: none;
      }
    }

    .kpm-mobile-logout {
      &:after {
        // TODO: Add proper logout icon
      }
    }

    & > li,
    & > li.kpm-profile-item,
    & > li.kpm-schedule-item,
    & > li.kpm-mobile-logout {
      display: unset;
      font-size: 1.1em;
      padding: 0;

      & > a {
        width: 100%;
        padding: 1em 0.75em;
        background-color: var(--kpmMenuHoverBg);
        color: var(--kpmMenuHoverText);

        &:hover {
          color: var(--kpmMenuText);
          background-color: var(--kpmMenuBg);

          // &::after {
          //   background: $data-arrow-expand-black-svg no-repeat;
          // }
        }
      }
    }
  }
}

@media #{$desktopMediumBreakpoint} {
  body #kpm-6cf53 > .kpm-menu {
    font-size: 0.9em;
    --kpmPad: 0.4rem;
  }
}
